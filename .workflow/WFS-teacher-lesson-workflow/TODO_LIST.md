# AI智能备课 - 教案编辑器功能开发

**会话**: WFS-teacher-lesson-workflow
**更新时间**: 2026-02-02 (v2.0)

---

## 项目概述

在现有AI智能备课页面中添加教案编辑功能，通过标签页切换实现AI对话和教案编辑两种模式。

## 技术方案

- **保持不变**：首页AI对话、AI智能备课页面的PPT生成功能、试题库页面
- **新增功能**：教案编辑器（所见即所得富文本编辑 + AI生成）
- **页面改造**：AI智能备课页面添加标签页切换

---

## 任务清单

| 任务ID | 标题 | 状态 | 工时 | 依赖 |
|--------|------|------|------|------|
| IMPL-001 | CurriculumService课程目录服务 | ✅ completed | 0.5天 | - |
| IMPL-002 | LessonPlanEditor教案编辑器 | ✅ completed | 1.5天 | IMPL-001 |
| IMPL-003 | AI智能备课页面改造（添加标签页） | ✅ completed | 0.5天 | IMPL-002 |
| IMPL-004 | 集成测试和调优 | 🔵 pending | 0.5天 | IMPL-003 |

---

## 详细任务说明

### ✅ IMPL-001: CurriculumService课程目录服务

**已完成！** 已创建以下文件：

| 文件 | 说明 |
|------|------|
| `src/services/CurriculumService.h` | 课程目录服务类头文件 |
| `src/services/CurriculumService.cpp` | 课程目录服务类实现 |
| `resources/data/curriculum_morality_law.json` | 道德与法治课程目录（七-九年级，53课时） |
| `resources.qrc` | 已更新，添加/data资源前缀 |

📄 [.task/IMPL-001.json](.task/IMPL-001.json)

---

### 🔵 IMPL-002: LessonPlanEditor教案编辑器

**目标：** 创建所见即所得的教案编辑器，对普通老师友好

**UI布局：**
```
┌────────────────────────────────────────────────────────────────┐
│  课程: [七年级▼] [上册▼] [成长的节拍▼] [中学时代▼]              │
│                                                                │
│  [🤖 AI生成教案]                                    [保存]      │
├────────────────────────────────────────────────────────────────┤
│  工具栏: [B加粗] [I斜体] [H1标题▼] [• 列表] [1. 编号]           │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  所见即所得富文本编辑区（QTextEdit富文本模式）                   │
│  用户直接编辑，像Word一样，无需了解Markdown                     │
│                                                                │
├────────────────────────────────────────────────────────────────┤
│  字数：1,234  |  已保存                                        │
└────────────────────────────────────────────────────────────────┘
```

**用户流程：**
1. 从下拉框选择课时（年级→学期→单元→课时）
2. 点击「AI生成教案」按钮
3. AI实时生成内容填入编辑器（已格式化）
4. 用户直接修改编辑（像用Word一样）
5. 点击保存

📄 [.task/IMPL-002.json](.task/IMPL-002.json)

---

### 🔵 IMPL-003: AI智能备课页面改造

**目标：** 在AI智能备课页面添加标签页切换

**UI布局：**
```
┌────────────────────────────────────────────────────────────────┐
│  AI智能备课                                                     │
├────────────────────────────────────────────────────────────────┤
│  [💬 AI对话]   [📝 教案编辑]                                    │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│   点击「AI对话」→ 显示现有ChatWidget（可生成PPT）               │
│   点击「教案编辑」→ 显示LessonPlanEditor                       │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

📄 [.task/IMPL-003.json](.task/IMPL-003.json)

---

### 🔵 IMPL-004: 集成测试和调优

**测试内容：**
- 课程目录加载
- 级联下拉框选择
- AI生成教案流式输出
- 富文本编辑格式化
- 保存功能
- 标签页切换

📄 [.task/IMPL-004.json](.task/IMPL-004.json)

---

## 统计

| 状态 | 数量 |
|------|------|
| 已完成 ✅ | 3 |
| 待开始 🔵 | 1 |
| **总计** | **4** |
| **预估工时** | **3人天** |

---

## 文件变更记录

| 文件 | 状态 | 说明 |
|------|------|------|
| `src/services/CurriculumService.h` | ✅ 已创建 | 课程目录服务类 |
| `src/services/CurriculumService.cpp` | ✅ 已创建 | 课程目录服务实现 |
| `resources/data/curriculum_morality_law.json` | ✅ 已创建 | 课程目录数据 |
| `resources.qrc` | ✅ 已修改 | 添加data资源 |
| `src/ui/LessonPlanEditor.h` | ✅ 已创建 | 教案编辑器头文件 |
| `src/ui/LessonPlanEditor.cpp` | ✅ 已创建 | 教案编辑器实现 |
| `src/dashboard/modernmainwindow.h` | ✅ 已修改 | 添加标签页容器 |
| `src/dashboard/modernmainwindow.cpp` | ✅ 已修改 | 改造AI智能备课页面 |
| `CMakeLists.txt` | ✅ 已修改 | 添加新源文件 |

---

## 历史版本

- **v2.0** (2026-02-02): 任务重构
  - 从10个任务简化为4个任务
  - 删除备课工作台相关任务（保持现有页面结构）
  - 删除课件编辑器、试题编辑器任务（复用现有功能）
  - 聚焦教案编辑器和AI智能备课页面改造
  - 总工时从16天降至3天
  - 旧任务已归档到 `.task/backup/v1.2/`

- **v1.x** (2026-02-02): 原备课工作台完整方案

---

## 执行命令

```bash
# 开始执行
/workflow:execute --session WFS-teacher-lesson-workflow

# 查看状态
/workflow:status --session WFS-teacher-lesson-workflow
```
