{
  "metadata": {
    "task_description": "教师备课上课流程设计 - AI思政智慧课堂系统中教师的完整教学工作流，包括备课准备（课件制作、AI辅助备课、试题准备）、课堂授课（互动教学、实时答题、课堂管理）、课后总结（作业布置、学情分析、教学反思）三大阶段",
    "timestamp": "2026-02-02T00:00:00Z",
    "keywords": [
      "教师备课",
      "课件制作",
      "PPT生成",
      "AI辅助备课",
      "试题管理",
      "组卷",
      "课堂授课",
      "互动教学",
      "实时答题",
      "学情分析",
      "数据分析",
      "通知系统",
      "Dify对话",
      "思政教学"
    ],
    "complexity": "medium",
    "session_id": "WFS-teacher-lesson-workflow"
  },
  "project_context": {
    "architecture_patterns": [
      "Qt6 Widgets + QML 混合架构",
      "Service 服务层模式",
      "信号槽通信机制",
      "MVC 分离 (UI/Service/Model)",
      "SSE 流式响应处理"
    ],
    "coding_conventions": {
      "naming": {
        "classes": "PascalCase (如 DifyService, ModernMainWindow)",
        "member_variables": "m_ 前缀 (如 m_networkManager)",
        "signals_slots": "camelCase (如 messageReceived, onReplyFinished)"
      },
      "error_handling": {
        "pattern": "信号槽异步错误回调",
        "example": "errorOccurred(const QString &error)"
      },
      "async_patterns": {
        "preferred": "Qt 信号槽 + QNetworkAccessManager 异步网络"
      },
      "comments": "中文注释和日志"
    },
    "tech_stack": {
      "language": "C++17",
      "framework": "Qt 6",
      "modules": [
        "Qt Widgets",
        "Qt Network",
        "Qt Charts",
        "Qt QuickWidgets",
        "Qt QML"
      ],
      "build": "CMake 3.16+",
      "backend": {
        "auth": "Supabase (PostgreSQL)",
        "ai_service": "Dify API (SSE 流式响应)",
        "ppt_generation": "讯飞 PPT API"
      }
    },
    "existing_modules": {
      "core_ui": {
        "ModernMainWindow": "主界面框架，侧边栏导航 + 内容区切换",
        "AIPreparationWidget": "AI智能备课页面，课件生成流程",
        "QuestionBankWindow": "试题库管理界面",
        "DataAnalyticsWidget": "数据分析报告界面"
      },
      "services": {
        "DifyService": "Dify AI 对话服务，SSE 流式响应",
        "PaperService": "试卷/题目 CRUD 服务",
        "XunfeiPPTService": "讯飞智文 PPT 生成服务",
        "PPTXGenerator": "本地 PPTX 生成器",
        "ExportService": "导出服务",
        "NotificationService": "站内通知服务",
        "HotspotService": "时政热点服务"
      },
      "ai_chat": {
        "AIChatDialog": "AI 对话弹窗",
        "ChatWidget": "气泡样式聊天组件",
        "ChatHistoryWidget": "聊天历史记录侧边栏"
      },
      "question_bank": {
        "QuestionRepository": "题目数据仓库",
        "QuestionBasket": "试题篮数据模型",
        "QuestionBasketWidget": "试题篮 UI 组件",
        "PaperComposerDialog": "组卷对话框"
      },
      "analytics": {
        "AnalyticsDataService": "分析数据服务",
        "PersonalAnalyticsPage": "个人学情分析页",
        "ClassAnalyticsPage": "班级学情分析页"
      }
    }
  },
  "assets": {
    "documentation": [
      {
        "path": "CLAUDE.md",
        "scope": "project-wide",
        "contains": ["项目概述", "技术栈", "目录结构", "核心模块", "代码规范"],
        "relevance_score": 0.98
      }
    ],
    "source_code": {
      "dashboard": [
        {
          "path": "src/dashboard/modernmainwindow.h",
          "role": "main-window",
          "description": "主界面框架，集成侧边栏导航、AI对话、通知系统",
          "exports": ["ModernMainWindow"],
          "relevance_score": 0.99
        },
        {
          "path": "src/dashboard/modernmainwindow.cpp",
          "role": "main-window-impl",
          "relevance_score": 0.95
        },
        {
          "path": "src/dashboard/ChatManager.h",
          "role": "chat-management",
          "description": "聊天管理器",
          "relevance_score": 0.85
        },
        {
          "path": "src/dashboard/SidebarManager.h",
          "role": "sidebar-management",
          "description": "侧边栏管理器",
          "relevance_score": 0.80
        }
      ],
      "ai_preparation": [
        {
          "path": "src/ui/aipreparationwidget.h",
          "role": "ai-preparation",
          "description": "AI智能备课页面，支持课件生成、模板选择、预览",
          "exports": ["AIPreparationWidget", "SlidePreviewDialog"],
          "relevance_score": 0.99
        },
        {
          "path": "src/ui/aipreparationwidget.cpp",
          "role": "ai-preparation-impl",
          "relevance_score": 0.95
        }
      ],
      "services": [
        {
          "path": "src/services/DifyService.h",
          "role": "ai-service",
          "description": "Dify AI 对话服务，SSE流式响应，支持对话历史",
          "exports": ["DifyService"],
          "relevance_score": 0.99
        },
        {
          "path": "src/services/DifyService.cpp",
          "role": "ai-service-impl",
          "relevance_score": 0.95
        },
        {
          "path": "src/services/PaperService.h",
          "role": "paper-service",
          "description": "试卷/题目服务，支持 CRUD 和检索",
          "exports": ["PaperService", "Paper", "PaperQuestion", "QuestionSearchCriteria"],
          "relevance_score": 0.95
        },
        {
          "path": "src/services/PaperService.cpp",
          "role": "paper-service-impl",
          "relevance_score": 0.90
        },
        {
          "path": "src/services/XunfeiPPTService.h",
          "role": "ppt-service",
          "description": "讯飞智文 PPT 生成服务",
          "exports": ["XunfeiPPTService"],
          "relevance_score": 0.92
        },
        {
          "path": "src/services/XunfeiPPTService.cpp",
          "role": "ppt-service-impl",
          "relevance_score": 0.88
        },
        {
          "path": "src/services/PPTXGenerator.h",
          "role": "pptx-generator",
          "description": "本地 PPTX 文件生成器",
          "relevance_score": 0.85
        },
        {
          "path": "src/services/ExportService.h",
          "role": "export-service",
          "description": "导出服务（试卷、报告等）",
          "relevance_score": 0.82
        },
        {
          "path": "src/services/QuestionParserService.h",
          "role": "question-parser",
          "description": "AI 试题解析服务",
          "relevance_score": 0.88
        },
        {
          "path": "src/services/DocumentReaderService.h",
          "role": "document-reader",
          "description": "文档读取服务",
          "relevance_score": 0.75
        }
      ],
      "question_bank": [
        {
          "path": "src/questionbank/questionbankwindow.h",
          "role": "question-bank-ui",
          "description": "试题库管理主界面，筛选、搜索、组卷",
          "exports": ["QuestionBankWindow"],
          "relevance_score": 0.95
        },
        {
          "path": "src/questionbank/questionbankwindow.cpp",
          "role": "question-bank-ui-impl",
          "relevance_score": 0.90
        },
        {
          "path": "src/questionbank/QuestionBasket.h",
          "role": "question-basket-model",
          "description": "试题篮数据模型",
          "relevance_score": 0.88
        },
        {
          "path": "src/questionbank/QuestionBasketWidget.h",
          "role": "question-basket-ui",
          "description": "试题篮 UI 组件",
          "relevance_score": 0.85
        },
        {
          "path": "src/questionbank/PaperComposerDialog.h",
          "role": "paper-composer",
          "description": "组卷对话框",
          "relevance_score": 0.90
        },
        {
          "path": "src/questionbank/QuestionRepository.h",
          "role": "question-repository",
          "description": "题目数据仓库",
          "relevance_score": 0.85
        }
      ],
      "ai_chat": [
        {
          "path": "src/ui/AIChatDialog.h",
          "role": "ai-chat-dialog",
          "description": "AI 对话弹窗组件",
          "relevance_score": 0.90
        },
        {
          "path": "src/ui/ChatWidget.h",
          "role": "chat-widget",
          "description": "气泡样式聊天组件",
          "relevance_score": 0.92
        },
        {
          "path": "src/ui/ChatHistoryWidget.h",
          "role": "chat-history",
          "description": "聊天历史记录侧边栏",
          "relevance_score": 0.85
        }
      ],
      "analytics": [
        {
          "path": "src/analytics/DataAnalyticsWidget.h",
          "role": "analytics-main",
          "description": "数据分析报告主界面，集成图表和AI报告生成",
          "exports": ["DataAnalyticsWidget"],
          "relevance_score": 0.92
        },
        {
          "path": "src/analytics/DataAnalyticsWidget.cpp",
          "role": "analytics-main-impl",
          "relevance_score": 0.88
        },
        {
          "path": "src/analytics/AnalyticsDataService.h",
          "role": "analytics-service",
          "description": "分析数据服务层",
          "relevance_score": 0.85
        },
        {
          "path": "src/analytics/ui/PersonalAnalyticsPage.h",
          "role": "personal-analytics",
          "description": "个人学情分析页面",
          "relevance_score": 0.88
        },
        {
          "path": "src/analytics/ui/ClassAnalyticsPage.h",
          "role": "class-analytics",
          "description": "班级学情分析页面",
          "relevance_score": 0.88
        }
      ],
      "notifications": [
        {
          "path": "src/notifications/NotificationService.h",
          "role": "notification-service",
          "description": "站内通知服务",
          "exports": ["NotificationService"],
          "relevance_score": 0.80
        },
        {
          "path": "src/notifications/ui/NotificationWidget.h",
          "role": "notification-ui",
          "description": "通知列表 UI 组件",
          "relevance_score": 0.75
        }
      ],
      "hotspot": [
        {
          "path": "src/ui/HotspotTrackingWidget.h",
          "role": "hotspot-ui",
          "description": "时政热点追踪组件",
          "relevance_score": 0.78
        },
        {
          "path": "src/services/HotspotService.h",
          "role": "hotspot-service",
          "description": "时政热点数据服务",
          "relevance_score": 0.75
        }
      ]
    },
    "config": [
      {
        "path": "CMakeLists.txt",
        "relevance_score": 0.70
      },
      {
        "path": "run_app.sh",
        "relevance_score": 0.65
      }
    ]
  },
  "dependencies": {
    "internal": [
      {
        "from": "ModernMainWindow",
        "to": "DifyService",
        "type": "service-dependency",
        "description": "主界面使用 AI 对话服务"
      },
      {
        "from": "ModernMainWindow",
        "to": "AIPreparationWidget",
        "type": "component-dependency",
        "description": "主界面包含 AI 备课页面"
      },
      {
        "from": "ModernMainWindow",
        "to": "QuestionBankWindow",
        "type": "component-dependency",
        "description": "主界面包含试题库窗口"
      },
      {
        "from": "ModernMainWindow",
        "to": "DataAnalyticsWidget",
        "type": "component-dependency",
        "description": "主界面包含数据分析组件"
      },
      {
        "from": "ModernMainWindow",
        "to": "NotificationService",
        "type": "service-dependency",
        "description": "主界面使用通知服务"
      },
      {
        "from": "QuestionBankWindow",
        "to": "PaperService",
        "type": "service-dependency",
        "description": "试题库使用试卷服务"
      },
      {
        "from": "AIPreparationWidget",
        "to": "XunfeiPPTService",
        "type": "service-dependency",
        "description": "备课页面使用 PPT 生成服务"
      },
      {
        "from": "DataAnalyticsWidget",
        "to": "DifyService",
        "type": "service-dependency",
        "description": "分析组件使用 AI 生成报告"
      },
      {
        "from": "DataAnalyticsWidget",
        "to": "AnalyticsDataService",
        "type": "service-dependency",
        "description": "分析组件使用数据服务"
      }
    ],
    "external": [
      {
        "package": "Qt6",
        "version": "^6.0",
        "usage": "UI 框架、网络、图表"
      },
      {
        "package": "Dify API",
        "usage": "AI 对话服务 (SSE 流式)"
      },
      {
        "package": "Supabase",
        "usage": "后端认证和数据存储"
      },
      {
        "package": "讯飞开放平台",
        "usage": "PPT 智能生成"
      }
    ]
  },
  "workflow_coverage": {
    "phase_1_preparation": {
      "status": "covered",
      "modules": [
        "AIPreparationWidget - 课件制作",
        "XunfeiPPTService - PPT 生成",
        "DifyService - AI 辅助备课",
        "QuestionBankWindow - 试题准备",
        "PaperComposerDialog - 组卷"
      ],
      "gaps": [
        "课程计划管理功能待扩展",
        "教学资源管理功能待扩展"
      ]
    },
    "phase_2_classroom": {
      "status": "partial",
      "modules": [
        "AIChatDialog - AI 互动",
        "ChatWidget - 实时对话"
      ],
      "gaps": [
        "实时答题互动功能需新建",
        "课堂管理功能需新建",
        "学生端互动功能需新建"
      ]
    },
    "phase_3_summary": {
      "status": "partial",
      "modules": [
        "DataAnalyticsWidget - 学情分析",
        "PersonalAnalyticsPage - 个人分析",
        "ClassAnalyticsPage - 班级分析",
        "NotificationService - 通知推送"
      ],
      "gaps": [
        "作业布置功能需新建",
        "教学反思记录功能需新建"
      ]
    }
  },
  "conflict_detection": {
    "risk_level": "low",
    "risk_factors": {
      "existing_implementations": 35,
      "api_changes": false,
      "architecture_changes": false,
      "data_model_changes": false,
      "breaking_changes": []
    },
    "affected_modules": [
      "ModernMainWindow (需扩展导航)",
      "新模块: 课堂互动",
      "新模块: 作业管理"
    ],
    "mitigation_strategy": "增量扩展现有架构，新增独立模块"
  }
}
