{
  "id": "IMPL-1",
  "title": "通知数据模型层",
  "status": "pending",
  "meta": {
    "priority": "high",
    "estimated_effort": "small",
    "dependencies": [],
    "blocked_by": [],
    "focus_paths": ["src/notifications/models/"]
  },
  "context": {
    "description": "创建通知系统的数据模型，包括 Notification 结构体/类。参考现有的 NewsItem.h 和 Student.h 模式，实现通知类型枚举（作业提交、请假审批、成绩发布、系统公告）、通知状态（已读/未读）、时间戳等核心字段。",
    "acceptance_criteria": [
      "2个文件创建: 验证 ls src/notifications/models/*.{h,cpp} | wc -l = 2",
      "4种通知类型枚举: Notification.h 包含 HomeworkSubmission, LeaveApproval, GradeRelease, SystemAnnouncement",
      "2种状态枚举: NotificationStatus 包含 Unread, Read",
      "8个核心字段: id, type, title, content, senderId, receiverId, createdAt, isRead",
      "2个序列化方法: fromJson() 和 toJson() 静态/成员方法",
      "1个验证方法: isValid() 返回 bool"
    ],
    "reference_patterns": [
      "src/hotspot/NewsItem.h - 结构体定义模式",
      "src/analytics/models/Student.h - 类定义+JSON序列化模式"
    ]
  },
  "flow_control": {
    "pre_analysis": [
      {
        "step": "load_reference_patterns",
        "commands": [
          "Read(src/hotspot/NewsItem.h)",
          "Read(src/analytics/models/Student.h)"
        ],
        "output_to": "reference_patterns"
      },
      {
        "step": "verify_directory_structure",
        "commands": [
          "bash(mkdir -p src/notifications/models)"
        ],
        "output_to": "directory_created"
      }
    ],
    "implementation_steps": [
      {
        "step": 1,
        "title": "创建通知类型和状态枚举",
        "description": "在 Notification.h 中定义 NotificationType 和 NotificationStatus 枚举",
        "modification_points": [
          "创建 src/notifications/models/Notification.h",
          "定义 NotificationType 枚举: 4个值 (HomeworkSubmission=0, LeaveApproval=1, GradeRelease=2, SystemAnnouncement=3)",
          "定义 NotificationStatus 枚举: 2个值 (Unread=0, Read=1)"
        ],
        "logic_flow": [
          "添加头文件保护 #ifndef NOTIFICATION_H",
          "包含必要头文件: QString, QDateTime, QJsonObject",
          "定义枚举类型",
          "声明 Notification 类"
        ],
        "depends_on": [],
        "output": "notification_header"
      },
      {
        "step": 2,
        "title": "实现 Notification 类成员",
        "description": "添加 8 个核心字段和 getter/setter 方法",
        "modification_points": [
          "添加私有成员: m_id(QString), m_type(NotificationType), m_title(QString), m_content(QString), m_senderId(QString), m_receiverId(QString), m_createdAt(QDateTime), m_isRead(bool)",
          "添加公有 getter 方法: 8个",
          "添加公有 setter 方法: 8个"
        ],
        "logic_flow": [
          "声明私有成员变量",
          "实现内联 getter 方法",
          "实现内联 setter 方法"
        ],
        "depends_on": [1],
        "output": "class_members"
      },
      {
        "step": 3,
        "title": "实现 JSON 序列化",
        "description": "添加 fromJson 和 toJson 方法用于与 Supabase 交互",
        "modification_points": [
          "创建 src/notifications/models/Notification.cpp",
          "实现静态方法 Notification::fromJson(const QJsonObject&)",
          "实现成员方法 Notification::toJson() const",
          "实现 isValid() 验证方法"
        ],
        "logic_flow": [
          "fromJson: 解析 JSON 字段到成员变量",
          "toJson: 序列化成员变量到 QJsonObject",
          "isValid: 检查 id 和 title 非空"
        ],
        "depends_on": [2],
        "output": "serialization"
      }
    ],
    "validation": [
      "验证文件存在: ls src/notifications/models/Notification.{h,cpp}",
      "验证编译通过: 添加到 CMakeLists.txt 后 cmake --build build --target AILoginSystem"
    ],
    "target_files": [
      "src/notifications/models/Notification.h:new:0-80",
      "src/notifications/models/Notification.cpp:new:0-60"
    ]
  }
}
